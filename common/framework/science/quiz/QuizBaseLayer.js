!function(){var i=ScienceBaseLayer.extend({_encourageLayer:null,_ENCOURAGE_LAYER_ZORDER:4e3,ROLE_ZORDER:10,POINT_ZORDER:20,MISSION_ZORDER:100,missionPoints:[],obstacles:[],collections:[],audioConfig:null,missions:[],collectionsConfig:[],uiData:null,missionPointsConfig:[],obstaclesConfig:[],destinationConfig:null,lines:{},ctor:function(){this._super(),this._encourageLayer=new cc.Layer,this.addChild(this._encourageLayer,this._ENCOURAGE_LAYER_ZORDER)},onEnter:function(){this._super(),this.initUI({title:h.title_png,nav:{refresh:!0,encourage:!0}}),this.hideRightNav(),this.missionPoints=[],this.obstacles=[],this.collections=[]},onEncourageCallback:function(){this.randomPlayEncourageAnimation()},randomPlayEncourageAnimation:function(){this.encourage||(this.encourage=new EncourageAnimation,this._encourageLayer.addChild(this.encourage)),this.encourage.randomPlay()},showRightNav:function(){var i=this.getNavButtonByTag("refresh"),t=this.getNavButtonByTag("encourage");i.visible=!0,t.visible=!0},hideRightNav:function(){var i=this.getNavButtonByTag("refresh"),t=this.getNavButtonByTag("encourage");i.visible=!1,t.visible=!1},onCloseCallback:function(){this.missionPanel.isShow?this.missionPanel.close():CCG.DEBUG_MODE?window.location="../test/":closeWindow()},onRefreshCallback:function(){this._super(),stopAllEffects(),this.missionPanel.refresh()},initConfig:function(i){this.missions=i.missions,this.collectionsConfig=i.collections,this.uiData=i.ui,this.audioConfig=i.audio||{},this.initBg(i.ui.bg),this.initMap(),this.initMissionPanel(),this.audioConfig.bgm&&(this.bgm=playSound(this.audioConfig.bgm,!0),cc.audioEngine.setMusicVolume(.1))},initMap:function(){this.initMapData(),this.initObstacles(),this.initOthers(),this.initMissionPoints(),this.initRole(),this.initCollections()},initMissionPanel:function(){this.missionPanel=new c(this),this.addChild(this.missionPanel,this.MISSION_ZORDER)},initMapData:function(){this.missionPointsConfig=[],this.obstaclesConfig=[],this.destinationConfig=null,this.lines={};for(var i=0;i<this.missions.length;i++)"point"==this.missions[i].type?this.missionPointsConfig.push(this.missions[i]):"obstacle"==this.missions[i].type?this.obstaclesConfig.push(this.missions[i]):"destination"==this.missions[i].type&&(this.destinationConfig=this.missions[i]),this.lines[this.missions[i].name]=this.missions[i].linePoints},initRole:function(){this.role=new n(this.tapRole,this),this.addChild(this.role,this.ROLE_ZORDER),this.role.setPosition(270,580),this.role.parseMission(this.missions)},initMissionPoints:function(){for(var i=0;i<this.missionPointsConfig.length;i++){var s=new t(this.uiData.missionPoint,this.missionPointsConfig[i],this.startMission,this);this.addChild(s,this.missionPointsConfig[i].zIndex||this.POINT_ZORDER);var n=this.missionPointsConfig[i].position;s.setPosition(n[0],n[1]),s.idle(),this.missionPoints.push(s)}},initObstacles:function(){for(var i=0;i<this.obstaclesConfig.length;i++){var t=new s(this.obstaclesConfig[i],this.tapObstacle,this);this.addChild(t);var n=this.obstaclesConfig[i].position;t.setPosition(n[0],n[1]),this.obstacles.push(t)}},initOthers:function(){var i=new e(this.destinationConfig);this.addChild(i);var t=this.destinationConfig.position;i.setPosition(t[0],t[1]);var s=this;addEvent(function(){s.role.nextStep!=s.missions.length-1||i.isOpen||(s.audioConfig.box&&playEffect(s.audioConfig.box),i.playAnimation())},i)},initCollections:function(){var i=new cc.Sprite(this.uiData.collection.bg);this.addChild(i),i.attr({anchorX:1,x:cc.winSize.width,y:60});var t=new cc.Sprite(this.uiData.collection.img);this.addChild(t),t.setPosition(725,65);for(var s=0;s<this.collectionsConfig.length;s++){var n=new o(this.collectionsConfig[s],this.tapCollection,this);this.addChild(n),n.setPosition(865+118*s,75),this.collections.push(n)}},startMission:function(i){if(this.role.ifArriveAt(i.getName()))if(i.isComplete){for(var t,s=0;s<this.collections.length;s++)if(i.getName()==this.collections[s].getName()){t=s;break}this.audioConfig.pick&&playEffect(this.audioConfig.pick),i.flyTo(this.collections[t],function(i){i.setCollectionState(!0)},this)}else this.missionPanel.show(i.getMissionData())},tapRole:function(i){var t=i.missions[i.nextStep];this.role.ifArriveAt(t)||(this.role.arriveAt(t),this.role.walkInLine(this.lines[t]))},tapObstacle:function(i){},tapCollection:function(i){var t=i.getResolveName();if(!this.role.ifArriveAt(t))return void i.wrong();for(var s=-1,n=0;n<this.obstacles.length;n++)if(this.obstacles[n].getName()==t){s=n;break}this.audioConfig.resolve&&playEffect(this.audioConfig.resolve),i.resolveTo(this.obstacles[s],function(i){i.pass(),this.role.passMission(i.getName()),this.role.happy()},this)}}),t=cc.Sprite.extend({data:null,_textureData:null,isComplete:!1,dot:null,ctor:function(i,t,s,n){this.data=t,this._textureData=i,this._super(t.imgs[0]),this.initDot();var e=this;addEvent(function(i,t){t.visible&&s.call(n,e)},this.dot)},initDot:function(){this.dot=new cc.Sprite(this._textureData),this.addChild(this.dot),this.dot.setPosition(.5*this.width,this.height+15)},showCollection:function(){this.stopAction(this.idleAction),this.isComplete=!0,this.dot.initWithFile(this.data.object),this.dot.setPosition(.5*this.width,this.height+15),this.shrink()},resetMission:function(){this.isComplete=!1,this.initWithFile(this._textureData),this.setPosition(this.data.position[0],this.data.position[1])},getName:function(){return this.data.name},getMissionData:function(){return this.data.mission.point=this,this.data.mission},flyTo:function(i,t,s){this.dot.stopAction(this.shrinkAction);var n=this.convertToNodeSpace(cc.p(i.x,i.y));this.dot.runAction(cc.moveTo(.6,n)),this.dot.runAction(cc.sequence(cc.delayTime(.4),cc.fadeOut(.2),cc.callFunc(function(){this.dot.visible=!1,t.call(s,i)},this)))},idle:function(){var i=this.dot.x,t=this.dot.y,s=cc.moveTo(.5,cc.p(i,t+15)),n=cc.moveTo(.3,cc.p(i,t));this.idleAction=cc.repeatForever(cc.sequence(cc.delayTime(.1),s,cc.delayTime(.1),n)),this.dot.runAction(this.idleAction)},shrink:function(){var i=cc.scaleTo(.5,1.2,1.2),t=cc.scaleTo(.3,1,1);this.shrinkAction=cc.repeatForever(cc.sequence(i,t)),this.dot.runAction(this.shrinkAction)}}),s=cc.Sprite.extend({data:null,ctor:function(i,t,s){this.data=i,this._super(i.imgs[0]);var n=this;addEvent(function(){t.call(s,n)},this)},pass:function(){this.setTexture(this.data.imgs[1])},getName:function(){return this.data.name}}),n=cc.Sprite.extend({isWalking:!1,data:{},missions:[],nextStep:0,ctor:function(i,t){this.roleTypes=[h.role_png],this._super(this.roleTypes[0]),this.anchorY=0;var s=this;addEvent(function(){s.isWalking||i.call(t,s)},this)},parseMission:function(i){for(var t=0;t<i.length;t++)this.data[i[t].name]=!1,this.missions.push(i[t].name)},arriveAt:function(i){this.data[i]=!0},ifArriveAt:function(i){return this.data[i]},passMission:function(i){this.nextStep=this.missions.indexOf(i)+1},getNextMissionName:function(){return this.missions[this.nextStep]},walkInLine:function(i,t,s){if(0!=i.length){this.runAction(cc.place(i[0].x,i[0].y));for(var n=[],e=1;e<i.length;e++){var o=cc.moveTo(i[e].duration||.3,cc.p(i[e].x||0,i[e].y||0));n.push(o)}var c=this;n.push(cc.callFunc(function(){c.isWalking=!1,t&&t.call(s)},this)),this.isWalking=!0,this.runAction(cc.sequence(n))}},reset:function(){this.setPosition(85,475),this.data={},this.missions=[],this.nextStep=0},happy:function(){this.isWalking=!0,this.happyAction=cc.sequence(cc.delayTime(.2),cc.jumpBy(.9,cc.p(0,0),40,2),cc.callFunc(function(){this.isWalking=!1},this)),this.runAction(this.happyAction)}}),e=cc.Sprite.extend({isOpen:!1,ctor:function(i){this._super(i.imgs[0]),this.data=i},playAnimation:function(){this.zIndex=90,this.runAction(cc.moveTo(1,cc.p(.5*cc.winSize.width,.5*cc.winSize.height))),this.runAction(cc.sequence(cc.scaleTo(1,2,2),cc.callFunc(this.success,this))),this.isOpen=!0},success:function(){if(this.data.animation){this.initWithFile(this.data.animation[0]),this.setPosition(.5*cc.winSize.width,.5*cc.winSize.height),this.scale=.7;var i=new AnimationFrames(this.data.animation.slice(0,2),.2),t=new AnimationFrames(this.data.animation.slice(1),.2);this.runAction(cc.sequence(i,cc.callFunc(function(){this.runAction(cc.repeatForever(t))},this)))}}}),o=cc.Sprite.extend({data:null,isCollected:!1,isUsed:!1,ctor:function(i,t,s){this.data=i,this._super(i.imgs[0]);var n=this;addEvent(function(){n.isCollected&&(n.isUsed||t.call(s,n))},this)},setCollectionState:function(i){this.isCollected=i,this.setTexture(this.data.imgs[1==i?1:0])},wrong:function(){var i=this.x,t=this.y,s=cc.moveTo(.2,cc.p(i-20,t)),n=cc.moveTo(.2,cc.p(i+20,t)),e=cc.moveTo(.1,cc.p(i,t));this.runAction(cc.sequence(s,n,e))},resolveTo:function(i,t,s){this.runAction(cc.moveTo(.6,cc.p(i.x,i.y))),this.runAction(cc.sequence(cc.delayTime(.4),cc.fadeOut(.2),cc.callFunc(function(){this.isUsed=!0,t.call(s,i)},this)))},getName:function(){return this.data.name},getResolveName:function(){return this.data.resolve}}),c=cc.Layer.extend({targetLayer:null,missionData:null,isTween:!1,isShow:!1,complete:!1,options:[],lastClickId:null,ctor:function(i){this._super(),this.targetLayer=i,this.init()},init:function(){this.y=-300,this.opacity=0,this.cascadeOpacity=!0,this.lastClickId=null},show:function(i){this.isTween||(this.targetLayer.showRightNav(),this.isShow=!0,this.complete=!1,this.missionData=i,this.initQuestion(i.bg,i.question),this.initOptions(i.options),this.appear())},close:function(){this.targetLayer.hideRightNav(),this.isShow=!1,this.complete=!1,stopAllEffects(),this.clearOptions(),this.disappear()},refresh:function(){this.clearOptions(),this.initQuestion(this.missionData.bg,this.missionData.question),this.initOptions(this.missionData.options)},initQuestion:function(i,t){this.questionBg?this.questionBg.setTexture(i):(this.questionBg=new cc.Sprite(i),this.addChild(this.questionBg),this.questionBg.setPosition(.5*cc.winSize.width,.5*cc.winSize.height)),t&&t.audio&&this.runAction(cc.sequence(cc.delayTime(t.audioDelayTime||.3),cc.callFunc(function(){playEffect(t.audio)},this)))},initOptions:function(i){for(var t=0;t<i.length;t++){var s=new a(i[t],this.selectOption,this);this.addChild(s);var n=i[t].position;s.setPosition(n[0],n[1]),this.options.push(s)}},clearOptions:function(){for(var i=0;i<this.options.length;i++)this.options[i].removeFromParent(!0);this.options.length=0},selectOption:function(i){return i.isAudioOption()&&this.lastClickId!=i.getInstanceId()?(this.lastClickId=i.getInstanceId(),void i.playOptionAudio()):void(1==i.getValue()?(this.playRightSound(),i.right(),this.isAllComplete()&&(this.complete=!0,this.missionData.point.showCollection(),this.targetLayer.role.passMission(this.missionData.point.getName()))):(this.playWrongSound(),i.wrong()))},isAllComplete:function(){for(var i=!0,t=0;t<this.options.length;t++)if(1==this.options[t].getValue()&&!this.options[t].isComplete){i=!1;break}return i},playRightSound:function(){var i=baseFeedBackAudioResource.rights;this._rightEffectId=playEffect(i[Math.floor(Math.random()*i.length)])},playWrongSound:function(){var i=baseFeedBackAudioResource.wrongs;this._wrongEffectId=playEffect(i[Math.floor(Math.random()*i.length)])},appear:function(){this.isTween=!0,this.opacity=0,this.runAction(cc.moveTo(.3,cc.p(0,0))),this.runAction(cc.sequence(cc.fadeTo(.3,255),cc.callFunc(function(){this.isTween=!1},this)))},disappear:function(){this.runAction(cc.moveTo(.3,cc.p(0,-300))),this.runAction(cc.fadeTo(.3,0))}}),a=cc.Sprite.extend({data:null,isComplete:!1,ctor:function(i,t,s){this.data=i,this._super(i.imgs[0]);var n=this;addEvent(function(){s.complete||n.isComplete||t.call(s,n)},this)},getValue:function(){return this.data.value},right:function(){this.scale=1.3,this.isComplete=!0},playOptionAudio:function(){this.data.audio&&playEffect(this.data.audio)},isAudioOption:function(){return Boolean(this.data.audio)},wrong:function(){var i=this.x,t=this.y,s=cc.moveTo(.2,cc.p(i-20,t)),n=cc.moveTo(.2,cc.p(i+20,t)),e=cc.moveTo(.1,cc.p(i,t));this.runAction(cc.sequence(s,n,e)),this.isComplete=!1},getInstanceId:function(){return this.__instanceId}}),h={title_png:"../../../common/res/science/quiz/title_quiz.png",role_png:"../../../common/res/science/quiz/role.png"};addModuleResourceByName(h),addModuleResourceByName(frame_success1),addModuleResourceByName(frame_success2),addModuleResourceByName(frame_success3),addModuleResourceByName(frame_success4),addModuleResourceByName(frame_success5),addModuleResourceByName(frame_success6),window.baseQuizRes=h,window.QuizBaseLayer=i}();