!function(){var t=ScienceBaseLayer.extend({ctor:function(){this._super()},onEnter:function(){this._super(),this.initUI({nav:{refresh:!1,encourage:!1}})},onCloseCallback:function(){this._super()},initConfig:function(t){this.sceneData=t.objects,this.initBg(t.bg),this.initTitle(t.title),this.initScene()},onRefreshCallback:function(){this._super(),stopAllEffects();for(var t=0;t<this.objects.length;t++)this.objects[t].reset();this.previewPanel&&this.previewPanel.close()},initScene:function(){var t=this.sceneData;this.objects=[],this.maxZIndex=0;for(var n=0;n<t.length;n++){var s=new e(t[n],this.selectViewObject,this);this.addChild(s);var c=t[n].position||[0,0];s.setInitPosition(c[0],c[1]),s.scale=t[n].scale||1,s.zIndex=t[n].zIndex||n,s.orginalIndex=t[n].zIndex||n,s.orginalIndex>this.maxZIndex&&(this.maxZIndex=s.orginalIndex),this.objects.push(s)}this.previewPanel=new i(this),this.addChild(this.previewPanel,30),this.previewPanel.setPosition(0,0)},selectViewObject:function(t){t.isShow?(t.back(),t.zIndex=t.orginalIndex):(t.show(function(){t.visible=!1,this.hideNavButton(),this.previewPanel.show(t.data.items)},this),t.zIndex=this.maxZIndex+1,this.selectObj=t)},closePreview:function(){this.showNavButton(),this.selectObj.visible=!0,this.selectObj.back(),this.selectObj.zIndex=this.selectObj.orginalIndex},hideNavButton:function(){var t=this.getNavButtonByTag("close"),e=this.getNavButtonByTag("refresh"),i=this.getNavButtonByTag("encourage");t&&t.setVisible(!1),e&&e.setVisible(!1),i&&i.setVisible(!1)},showNavButton:function(){var t=this.getNavButtonByTag("close"),e=this.getNavButtonByTag("refresh"),i=this.getNavButtonByTag("encourage");t&&t.setVisible(!0),e&&e.setVisible(!0),i&&i.setVisible(!0)},getObjects:function(){return this.objects}}),e=cc.Sprite.extend({data:null,initX:0,initY:0,isShow:!1,ctor:function(t,e,i){this.data=t,this._super(t.img);var n=this;addEvent(function(){n.visible&&(i.previewPanel&&i.previewPanel.isShow||e.call(i,n))},this)},setInitPosition:function(t,e){this.initX=t,this.initY=e,this.setPosition(t,e)},blink:function(){var t=cc.sequence(cc.delayTime(0),cc.blink(2,2));cc.sequence(cc.fadeTo(.6,50),cc.delayTime(.2),cc.fadeTo(.3,255),cc.delayTime(.2));this.runAction(cc.repeatForever(t))},show:function(t,e){var i=cc.moveTo(.4,cc.p(.5*cc.winSize.width,.5*cc.winSize.height)),n=cc.scaleTo(.3,1,1);this.runAction(cc.sequence(i,cc.callFunc(function(){t&&t.call(e)},this))),this.runAction(n),this.isShow=!0},reset:function(){this.setPosition(this.initX,this.initY),this.visible=!0,this.isShow=!1},back:function(){stopAllEffects();var t=cc.moveTo(.3,cc.p(this.initX,this.initY)),e=cc.scaleTo(.3,1,1);this.runAction(t),this.runAction(e),this.isShow=!1}}),i=cc.Layer.extend({data:null,pageIndex:0,pages:[],isShow:!1,isTween:!1,container:null,targetLayer:null,ctor:function(t){this._super(),this.targetLayer=t},onEnter:function(){this._super(),this.grayLayer=new cc.LayerColor(cc.color(150,150,150,150)),this.addChild(this.grayLayer),this.grayLayer.visible=!1,this.container=new cc.Layer,this.addChild(this.container),this.closeBtn=new Button([navRes.button_close_normal_png,navRes.button_close_selected_png],this.close,this),this.addChild(this.closeBtn),this.closeBtn.setPosition(cc.winSize.width-50,cc.winSize.height-35),this.closeBtn.visible=!1,this.prevBtn=new Button([n.button_prev_png,n.button_prev2_png],this.prevPage,this),this.nextBtn=new Button([n.button_next_png,n.button_next2_png],this.nextPage,this),this.addChild(this.prevBtn),this.addChild(this.nextBtn),this.prevBtn.setPosition(.5*cc.winSize.width-50,100),this.nextBtn.setPosition(.5*cc.winSize.width+50,100),this.prevBtn.visible=!1,this.nextBtn.visible=!1,this.addEventListeners()},show:function(t){this.data=t,this.isShow=!0,this.visible=!0,this.grayLayer.visible=!0,this.closeBtn.visible=!0,this.prevBtn.visible=!0,this.nextBtn.visible=!0;for(var e=.5*cc.winSize.width,i=cc.winSize.width,n=0;n<t.length;n++){var s=new cc.Sprite(t[n].img);s.setPosition(e+n*i,.5*cc.winSize.height),this.container.addChild(s),this.pages.push(s)}this.data[this.pageIndex].audio&&playEffect(this.data[this.pageIndex].audio)},clearPages:function(){for(var t=0;t<this.pages.length;t++)this.pages[t].removeFromParent(!0);this.pages.length=0,this.pageIndex=0,this.container.x=0},nextPage:function(){this.isTween||this.viewPage(this.pageIndex+1)},prevPage:function(){this.isTween||this.viewPage(this.pageIndex-1)},viewPage:function(t){var e=this.pageIndex==t?!1:!0;0>t?(t=0,e=!1):t>this.data.length-1&&(t=this.data.length-1,e=!1),this.pageIndex=t;var i=cc.winSize.width,n=this;this.isTween=!0,this.container.runAction(cc.sequence(cc.moveTo(.3,cc.p(-this.pageIndex*i,this.container.y)),cc.callFunc(function(){n.isTween=!1,e&&n.data[n.pageIndex].audio&&playEffect(n.data[n.pageIndex].audio)},this)))},close:function(){this.isShow=!1,this.visible=!1,this.grayLayer.visible=!1,this.closeBtn.visible=!1,this.prevBtn.visible=!1,this.nextBtn.visible=!1,this.clearPages(),stopAllEffects(),this.targetLayer.closePreview()},addEventListeners:function(){var t=0,e=300,i=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!1,onTouchBegan:function(e,i){var n=(e.getLocation(),i.getCurrentTarget());return n.isShow&&!n.isTween?(t=n.container.x,i.stopPropagation(),!0):!1},onTouchMoved:function(t,e){var i=e.getCurrentTarget(),n=t.getDelta();t.getLocation();i.container.x+=n.x},onTouchEnded:function(i,n){var s=i.getLocation(),c=n.getCurrentTarget();if(Math.abs(c.container.x-t)<5){var a=c.pages[c.pageIndex].getBoundingBoxToWorld();cc.rectContainsPoint(a,s)&&c.data[c.pageIndex].audio&&playEffect(c.data[c.pageIndex].audio)}if(Math.abs(c.container.x-t)>e){var o=c.container.x-t<0?1:-1;c.viewPage(c.pageIndex+o)}else c.viewPage(c.pageIndex)}});cc.eventManager.addListener(i,this)}}),n={button_prev_png:"../../../common/res/science/wiki/button_prev.png",button_prev2_png:"../../../common/res/science/wiki/button_prev2.png",button_next_png:"../../../common/res/science/wiki/button_next.png",button_next2_png:"../../../common/res/science/wiki/button_next2.png"};window.WikiBaseLayer=t}();