!function(){var t=cc.Layer.extend({opts:{loadingImg:pbRes_a.loading,autoPlay:!0},_audioHtml:'<audio id="media_audio"></audio>',_audio:null,_status:null,ctor:function(t){this._super(),this.addOpts(),this.createAudio(),this.loading(),this.setAudioEventBase(),t&&this.setAudioUrl(t)},addOpts:function(t){cc.extend(this.opts,t)},createAudio:function(){$("#Cocos2dGameContainer").append(this._audioHtml)},loading:function(){this.bg_loading=new cc.Sprite(this.opts.loadingImg),this.bg_loading.attr({anchorX:0,anchorY:0}),this.addChild(this.bg_loading),this._status="loading"},setAudioEventBase:function(){var t=this;this._audio=document.getElementById("media_audio"),this._audio.addEventListener("canplaythrough",function(){"play"!=t._status&&(t.canPlay(),t.opts.autoPlay&&t.setAudioPlay())},!1),this._audio.addEventListener("timeupdate",function(i){var s=i.currentTarget;s.currentTime>0&&s.currentTime>=s.duration&&"ended"!=t._status&&(t.onEnded(),t._status="ended")},!1)},setAudioUrl:function(t){this._audio.src=t},setAudioPlay:function(t){this._audio.play(),this._status="play",t&&this._audio.currentTime>0&&(this._audio.currentTime=0)},setAudioPause:function(){this._audio.pause(),this._status="pause"},setAudioStop:function(){this._audio.paused||this.setAudioPause()},canPlay:function(){this.removeChild(this.bg_loading),this.onLoaded()},onLoaded:function(){},onEnded:function(){},onClosed:function(){this._audio.paused||this.setAudioPause(),$(this._audio).remove()}});window.cc.progressBarBase_audio=t}(),function(){function timeConvert(t){t=parseInt(t);var i,s,e,n;return s=parseInt(t/60),i=10>s?"0"+s:s,n=t%60,e=10>n?"0"+n:n,i+":"+e}var progressBar=cc.progressBarBase_audio.extend({audios:[],timeLines:[],audioIndex:0,btnCaption:null,btnSource:null,btnPlay:null,caption:null,ctor:function(t){var i=this;if(cc.isString(t.timeLines))this.timeLines.push({path:t.timeLines});else if(cc.isArray(t.timeLines)){if(t.timeLines.length!=t.audios.length)throw"音频和字幕不能一一对应！";t.timeLines.forEach(function(t){i.timeLines.push({path:t})})}cc.isString(t.audios)?(this._super(t.audios),this.audios.push(t.audios)):cc.isArray(t.audios)&&(this._super(t.audios[0]),this.audios=t.audios),this.setAudioEvent()},addOpts:function(t){this._super(cc.extend({autoPlay:!1,showVolume:!1,barBg:pbRes_a.tpl1_bg,playImg:pbRes_a.tpl1_play,stopImg:pbRes_a.tpl1_stop,bar1:pbRes_a.tpl1_color1,bar2:pbRes_a.tpl1_color2,point:pbRes_a.point,audltPlay:pbRes_a.tpl1_audltPlay,audltStop:pbRes_a.tpl1_audltStop,childPlay:pbRes_a.tpl1_childPlay,childStop:pbRes_a.tpl1_childStop,script:pbRes_a.tpl1_script,scriptOff:pbRes_a.tpl1_scriptOff,audioBg:pbRes_a.tpl1_audioBg,bar21:pbRes_a.tpl1_audioProgressBg,bar22:pbRes_a.tpl1_audioProgress,horn1:pbRes_a.tpl1_audio1,horn2:pbRes_a.tpl1_audio2,audioPoint:pbRes_a.tpl1_audioPoint,anchor:pbRes_a.tpl1_anchor,question:pbRes_a.tpl1_question},t))},setAudioEvent:function(){var t=this;this._audio.addEventListener("timeupdate",function(i){if(t.progress){var s=i.currentTarget;if(s.currentTime>0){t.progress.setValue(s.currentTime,!0),t.txtCurrentTime.setString(timeConvert(s.currentTime));for(var e=t.timeLines[t.audioIndex].data,n=0,a=e.length;a>n;n++){if(n+1==a){t.setCaption(e[n].value);break}if(e[n].time<s.currentTime&&e[n+1].time>s.currentTime){t.setCaption(e[n].value);break}}}}},!1),this._audio.addEventListener("play",function(){t.btnPlay._status="play",t.btnPlay.setTexture(t.opts.stopImg),t.setBtnSourceDisabled()},!1),this._audio.addEventListener("pause",function(){t.btnPlay._status="pause",t.btnPlay.setTexture(t.opts.playImg),t.setBtnSourceEnabled()},!1),this._audio.addEventListener("durationchange",function(i){var s=i.currentTarget;t.progress&&t.progress.setMaximumValue(s.duration),t.txtDuration&&t.txtDuration.setString(timeConvert(s.duration))},!1)},onLoaded:function(){var t=this,i=0;this.timeLines.forEach(function(s,e){cc.loader.loadJson(s.path,function(e,n){s.data=n,++i==t.timeLines.length&&t.initItem()})}),this.tempChildren=[],this.children.forEach(function(i){t.tempChildren.push(i)})},initItem:function(){var t=this;this.audioBg=new cc.Sprite(this.opts.audioBg),this.addChild(this.audioBg,0);var i=new cc.Sprite(this.opts.barBg);i.attr({anchorX:.5,anchorY:0,x:.5*cc.winSize.width+40}),this.addChild(i),this.barBg=i,this.audioBg.setPosition(this.barBg.x+.5*this.barBg.width,30),this.caption=new TextField("",40,CCG.FONT.KAITI,cc.color("#FFFFFF")),this.caption.enableStroke(cc.color("#05718B"),3),this.addChild(this.caption),this.caption.setPosition(cc.winSize.width/2,120),this.caption.setVisible(!1),this.createBtn(),this.createProgressBar(),this.createSliderHorn(),this.tempChildren.forEach(function(i){t.removeChild(i)}),delete this.tempChildren},createBtn:function(){var that=this;this.btnCaption=new cc.Sprite(this.opts.script),this.btnCaption.attr({anchorX:0,anchorY:0}),this.btnCaption._status="on",this.showCaption(),this.barBg.addChild(this.btnCaption),this.btnCaption.setPosition(this.barBg.width+5,35),addEvent(function(t,i){"on"==i._status?(i._status="off",i.setTexture(that.opts.scriptOff),that.hideCaption()):"off"==i._status&&(i._status="on",i.setTexture(that.opts.script),that.showCaption())},this.btnCaption);var btnSourceStatus;btnSourceStatus=this.btnSource?this.btnSource._status:"audlt",this.btnSource=new cc.Sprite(eval("this.opts."+btnSourceStatus+"Play")),this.btnSource.attr({anchorX:0,anchorY:0}),this.btnSource._status=btnSourceStatus,this.btnSource._enabled=!0,this.showCaption(),this.barBg.addChild(this.btnSource),this.btnSource.setPosition(this.barBg.width+5,0),addEvent(function(t,i){i._enabled&&that.audios.length>1&&(that.audioIndex++,that.audioIndex==that.audios.length&&(that.audioIndex=0),that._audio.paused||that.setAudioPause(),"audlt"==i._status?(i._status="child",i.setTexture(that.opts.childPlay)):"child"==i._status&&(i._status="audlt",i.setTexture(that.opts.audltPlay)),that.setAudioUrl(that.audios[that.audioIndex]))},this.btnSource),this.btnPlay=new cc.Sprite(this.opts.playImg),this.btnPlay.attr({anchorX:0,anchorY:0}),this.btnPlay._status="pause",this.barBg.addChild(this.btnPlay),this.btnPlay.setPosition(50,0),addEvent(function(t,i){"pause"==i._status?that.setAudioPlay():"play"==i._status&&that.setAudioPause()},this.btnPlay),this.btnHorn=new cc.Sprite(this.opts.horn1),this.btnHorn.attr({anchorX:0,anchorY:0,x:895,y:35}),this.barBg.addChild(this.btnHorn),this.btnQues=new cc.Sprite(this.opts.question),this.btnQues.attr({anchorX:0,anchorY:0,x:895,y:0}),this.barBg.addChild(this.btnQues),addEvent(function(t,i){that.viewQuestion.call(that)},this.btnQues)},createProgressBar:function(){var t=this,i=new cc.ControlSlider(this.opts.bar1,this.opts.bar2,this.opts.anchor);this.barBg.addChild(i),i.attr({anchorX:0,anchorY:0,x:130,y:10}),i.setMinimumValue(0),i.setMaximumValue(this._audio.duration),i.addTargetWithActionForControlEvents(this,function(i){t._audio.currentTime=i.getValue(),t._audio.paused&&t.setAudioPlay()},cc.CONTROL_EVENT_VALUECHANGED),this.progress=i,i.thumbSprite.y+=5,this.txtCurrentTime=new TextField("00:00",20,"黑体"),this.barBg.addChild(this.txtCurrentTime),this.txtCurrentTime.setPosition(740,30);var s=new TextField("/",20,"黑体");this.barBg.addChild(s),s.setPosition(780,30);var e=new TextField(timeConvert(this._audio.duration),20,"黑体");this.barBg.addChild(e),e.setPosition(820,30),this.txtDuration=e},showCaption:function(){this.caption.setVisible(!0)},hideCaption:function(){this.caption.setVisible(!1)},setCaption:function(t){this.caption.string!=t&&this.caption.setString(t)},setBtnSourceDisabled:function(){this.btnSource._enabled=!1,this.btnSource.setTexture(eval("this.opts."+this.btnSource._status+"Stop"))},setBtnSourceEnabled:function(){this.btnSource._enabled=!0,this.btnSource.setTexture(eval("this.opts."+this.btnSource._status+"Play"))},createSliderHorn:function(){var t=new cc.ControlSlider(this.opts.bar21,this.opts.bar22,this.opts.audioPoint);this.barBg.addChild(t),t.setMinimumValue(0),t.setMaximumValue(1.01),t.setMaximumAllowedValue(1),t.setValue(1),this.sliderHorn=t,this.sliderHorn.attr({anchorX:0,anchorY:0,rotation:270,x:915,y:75,visible:!1}),this.sliderHornEvent(),this.btnHornEvent()},sliderHornEvent:function(){var t=this,i=this.sliderHorn;i.addTargetWithActionForControlEvents(this,function(i){var s=i.getValue();t._audio.volume=i.getValue(),0==s?t.btnHorn.setTexture(t.opts.horn2):t.btnHorn.setTexture(t.opts.horn1)},cc.CONTROL_EVENT_VALUECHANGED)},btnHornEvent:function(){var t=this,i=this.btnHorn;addEvent(function(){t.sliderHorn.setVisible(!t.sliderHorn.visible)},i)},viewQuestion:function(){}});window.cc.progressBar1_audio=progressBar}(),function(){function t(t){return Math.floor(Math.random()*t)}var i=cc.progressBarBase_audio.extend({_res:[],_currIndex:0,_bg:null,_cBg:null,_bgAudio:null,ctor:function(t,i){this._res=i||[],this._super(t)},addOpts:function(t){this._super(cc.extend({autoPlay:!1},t))},onLoaded:function(){this._super(),this.initBg(),this.initPanel(),this.onStart()},initBg:function(){var i=t(this._res.length),s=new cc.Sprite(this._res[i].imgs[0]);this.addChild(s),s.attr({x:cc.winSize.width/2,y:cc.winSize.height/2}),this._currIndex=i,this._bg=s,this._bgAudio=playEffect(this._res[i].mp3),this._bgAudio.pause()},initPanel:function(){var t=this;cc.spriteFrameCache.addSpriteFrames(pbRes_a.tpl2_ui1_plist);var i=new cc.Sprite("#kuang02.png");this.addChild(i,100),i.attr({anchorY:0,x:cc.winSize.width/2}),this._cBg=i;var s=new cc.Sprite("#shuaxin.png");i.addChild(s),s.attr({active:!0,anchorX:0,anchorY:0,x:240,y:15}),addEvent(function(){s.active&&t.refresh()},s),this._btnShuaxin=s;var e=new cc.Sprite("#zhidao.png");i.addChild(e),e.attr({active:!0,anchorX:0,anchorY:0,x:295,y:30}),addEvent(function(){e.active&&t.playInstruction()},e),this._btnZhidao=e;var n=new cc.Sprite("#kaishi.png");i.addChild(n),n.attr({status:"on",anchorX:0,anchorY:0,x:373,y:2}),addEvent(function(){"on"==n.status?t.bgPlay():"off"==n.status&&t.bgPause()},n),this._btnPlay=n;var a=new cc.Sprite("#yutian.png");i.addChild(a),a.attr({status:"yu",anchorX:0,anchorY:0,x:450,y:30}),addEvent(function(){"yu"==a.status?t.weatherYu():"qing"==a.status&&t.weatherQing()},a),this._btnWeather=a;var o=new cc.Sprite("#shengyin.png");i.addChild(o),o.attr({status:"on",anchorX:0,anchorY:0,x:530,y:15}),addEvent(function(){"on"==o.status?t.hornOn():"off"==o.status&&t.hornOff()},o),this._btnHorn=o;var r=new cc.ControlSlider("#shengyintiao1.png","#shengyintiao2.png","#shengyinanniu.png");i.addChild(r),r.attr({anchorX:0,anchorY:0,x:585,y:28,visible:!1}),r.setMinimumValue(0),r.setMaximumValue(1),r.setValue(this._bgAudio.getVolume()),r.addTargetWithActionForControlEvents(this,function(i){t.volumeChanged(i)},cc.CONTROL_EVENT_VALUECHANGED),this._slider=r},onStart:function(){this._btnZhidao.setSpriteFrame("zhidao2.png"),this._btnZhidao.active=!1},refresh:function(){var i;do i=t(this._res.length);while(i==this._currIndex);this._bg.setTexture(this._res[i].imgs[0]),this._currIndex=i;var s=playEffect(this._res[i].mp3);s.pause(),s.setVolume(this._slider.getValue()),this._bgAudio=s,this.weatherQing()},playInstruction:function(){this.setAudioPlay(!0),this._btnZhidao.setSpriteFrame("zhidao2.png"),this._btnZhidao.active=!1},bgPlay:function(){this._bgAudio.play(),this._btnPlay.setSpriteFrame("zanting.png"),this._btnPlay.status="off",this._btnZhidao.setSpriteFrame("zhidao.png"),this._btnZhidao.active=!0,this._btnShuaxin.setSpriteFrame("shuaxin2.png"),this._btnShuaxin.active=!1},bgPause:function(){this._bgAudio.pause(),this._btnPlay.setSpriteFrame("kaishi.png"),this._btnPlay.status="on",this.setAudioStop(),this._btnZhidao.setSpriteFrame("zhidao2.png"),this._btnZhidao.active=!1,this._btnShuaxin.setSpriteFrame("shuaxin.png"),this._btnShuaxin.active=!0},weatherYu:function(){this._btnWeather.setSpriteFrame("qingtian.png"),this._btnWeather.status="qing";var t=this._res[this._currIndex].imgs;this._bg.runAction(cc.repeatForever(new AnimationFrames([t[2],t[1]],.1)))},weatherQing:function(){this._btnWeather.setSpriteFrame("yutian.png"),this._btnWeather.status="yu",this._bg.stopAllActions(),this._bg.setTexture(this._res[this._currIndex].imgs[0])},hornOn:function(){this._btnHorn.setSpriteFrame("shengyin2.png"),this._btnHorn.status="off",this._slider.setVisible(!0)},hornOff:function(){this._btnHorn.setSpriteFrame("shengyin.png"),this._btnHorn.status="on",this._slider.setVisible(!1)},volumeChanged:function(t){this._bgAudio.setVolume(t.getValue())},setPosition:function(t,i){this._cBg.setPosition(t,i)},onClosed:function(){this._super(),this._bgAudio.pause()}});window.cc.progressBar2_audio=i}();